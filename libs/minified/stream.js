!function(){"use strict";var e=0,r={};function i(){function t(){return 0<arguments.length&&arguments[0]!==r&&a(t,arguments[0]),t._state.value}var n;return(n=t).constructor=i,n._state={id:e++,value:void 0,state:0,derive:void 0,recover:void 0,deps:{},parents:[],endStream:void 0,unregister:void 0},n.map=n["fantasy-land/map"]=c,n["fantasy-land/ap"]=d,n["fantasy-land/of"]=i,n.valueOf=_,n.toJSON=v,n.toString=_,Object.defineProperties(n,{end:{get:function(){if(!n._state.endStream){var e=i();e.map(function(t){return!0===t&&(f(n),e._state.unregister=function(){f(e)}),t}),n._state.endStream=e}return n._state.endStream}}}),0<arguments.length&&arguments[0]!==r&&a(t,arguments[0]),t}function a(t,e){for(var n in s(t,e),t._state.deps)u(t._state.deps[n],!1);null!=t._state.unregister&&t._state.unregister(),function(t){for(var e in t._state.changed=!1,t._state.deps)t._state.deps[e]._state.changed=!1}(t)}function s(t,e){t._state.value=e,t._state.changed=!0,2!==t._state.state&&(t._state.state=1)}function u(t,e){var n=t._state.parents;if(0<n.length&&n.every(l)&&(e||n.some(m))){var a=t._state.derive();if(a===r)return!1;s(t,a)}}function o(t,e){if(!e.every(p))throw new Error("Ensure that each item passed to stream.combine/stream.merge is a stream");return n=i(),a=e,r=function(){return t.apply(this,e.concat([e.filter(m)]))},(s=n._state).derive=r,s.parents=a.filter(h),function t(e,n){for(var a=0;a<n.length;a++)n[a]._state.deps[e._state.id]=e,t(e,n[a]._state.parents)}(n,s.parents),u(n,!0),n;var n,a,r,s}function f(t){for(var e=0;e<t._state.parents.length;e++){delete t._state.parents[e]._state.deps[t._state.id]}for(var n in t._state.deps){var a=t._state.deps[n],r=a._state.parents.indexOf(t);-1<r&&a._state.parents.splice(r,1)}t._state.state=2,t._state.deps={}}function c(e){return o(function(t){return e(t())},[this])}function d(t){return o(function(t,e){return t()(e())},[t,this])}function _(){return this._state.value}function v(){return null!=this._state.value&&"function"==typeof this._state.value.toJSON?this._state.value.toJSON():this._state.value}function p(t){return t._state}function l(t){return 1===t._state.state}function m(t){return t._state.changed}function h(t){return 2!==t._state.state}(i["fantasy-land/of"]=i).merge=function(t){return o(function(){return t.map(function(t){return t()})},t)},i.combine=o,i.scan=function(e,n,t){var a=o(function(t){return n=e(n,t._state.value)},[t]);return 0===a._state.state&&a(n),a},i.scanMerge=function(a,r){var t=a.map(function(t){var e=t[0];return 0===e._state.state&&e(void 0),e});return o(function(){var n=arguments[arguments.length-1];return t.forEach(function(t,e){-1<n.indexOf(t)&&(r=a[e][1](r,t._state.value))}),r},t)},i.HALT=r,"undefined"!=typeof module?module.exports=i:"function"!=typeof window.m||"stream"in window.m?window.m={stream:i}:window.m.stream=i}();